"use strict";!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("jquery"),require("handlebars")):"function"==typeof define&&define.amd?define(["jquery","handlebars"],t):t(e.jQuery,e.window)}(window,function(h,k){h=h&&h.hasOwnProperty("default")?h.default:h;var r=function(e){if(e)for(var t=e.lastChild;t;){var l=t.previousSibling;e.removeChild(t),t=l}};h.fn.checklist=function(){for(var e=arguments.length,t=Array(e),l=0;l<e;l++)t[l]=arguments[l];if("string"==typeof t[0]){var i=_[t[0]];if("function"==typeof i)return i.apply(this,Array.prototype.slice.call(t,1));console.error(t[0]+" is not a function.")}else n.apply(this,t)},h.checklist={defaultTemplate:'<div class="ckl-container">\n\t{{#if opts.actionsBox}}\n\t<div ckl-actions>\n\t\t{{#if multiple}}\n\t\t<button type="button" ckl-select-all class="btn btn-default" {{#if disabled}}disabled{{/if}}>{{opts.selectAllText}}</button>\n\t\t{{/if}}\n\t\t<button type="button" ckl-deselect-all class="btn btn-default" {{#if disabled}}disabled{{/if}}>{{#if multiple}}{{opts.deselectAllText}}{{else}}{{opts.deselectText}}{{/if}}</button>\n\t</div>\n\t{{/if}}\n\t<ul>\n\t\t{{#each items}}\n\t\t<li ckl-item>\n\t\t\t<input ckl-input value="{{value}}" name="{{../inputName}}" type="{{../inputType}}" {{#if ../disabled}}disabled{{/if}} {{#if _chklst_selected}}checked{{/if}}/>\n\t\t\t{{text}}\n\t\t</li>\n\t\t{{/each}}\n\t</ul>\n\t</div>'};var o=0,n=function(r){this.each(function(e,t){var l=h.extend({template:h.checklist.defaultTemplate,selectAllText:"Select All",deselectAllText:"Deselect All",deselectText:"Deselect"},r),i=h(t),n=i.prop("multiple"),c=i.attr("name")||"_ckl_"+o;i.removeAttr("name").hide(),o++;var a={opts:l,multiple:n,inputType:n?"checkbox":"radio",inputName:c,disabled:i.prop("disabled")};t._ckl_ctx=a,_.refresh.call(i)})},_={selectAll:function(){return this.each(function(e,t){t._ckl_ctx&&t._ckl_ctx.$ele?t._ckl_ctx.$ele.find("input:radio,input:checkbox").prop("checked",!0):h(t).prop("multiple")&&h(t).find("option").prop("selected",!0)}),this},deselectAll:function(){return this.each(function(e,t){t._ckl_ctx&&t._ckl_ctx.$ele?t._ckl_ctx.$ele.find("input:radio,input:checkbox").prop("checked",!1):h(t).find("option").prop("selected",!1)}),this},disable:function(){return this.each(function(e,t){t._ckl_ctx&&t._ckl_ctx.$ele?t._ckl_ctx.$ele.find("input:radio,input:checkbox").prop("disabled",!0):h(t).prop("disabled",!0)}),this},enable:function(){return this.each(function(e,t){t._ckl_ctx&&t._ckl_ctx.$ele?t._ckl_ctx.$ele.find("input:radio,input:checkbox").prop("disabled",!1):h(t).prop("disabled",!1)}),this},getValue:function(){var e=this[0];if(e)return e._ckl_ctx&&e._ckl_ctx.$ele?e._ckl_ctx.$ele.inputVal()[e._ckl_ctx.inputName]:this.val()},setValue:function(a){return this.each(function(e,t){if(r(t),!Array.isArray(a)){var l=a;a=[],null!=l&&a.push(l)}for(var i=0;i<a.length;i++){var n=document.createElement("option");n.setAttribute("value",a[i]),n.setAttribute("selected","selected"),t.appendChild(n)}if(h(t).val(a),t._ckl_ctx&&t._ckl_ctx.$ele){var c={};c[t._ckl_ctx.inputName]=a,t._ckl_ctx.$ele.inputVal(c)}}),this},refresh:function(){return Promise.all(this.map(function(e,p){var s=h(p),d=p._ckl_ctx;if(!d)return Promise.resolve();var f=d.opts;return d.$ele&&(d.$ele.remove(),d.$ele=void 0),(f.hasOwnProperty("ajax")?"function"==typeof f.ajax?f.ajax():new Promise(function(e,t){h.ajax(f.ajax).done(e).fail(t)}):Promise.resolve(s.find("option").map(function(e,t){var l=h(t);return{value:l.attr("value"),text:l.text()}}).toArray())).then(function(e){e||(e=[]);var t=x(p),l=!0,i=!1,n=void 0;try{for(var c,a=e[Symbol.iterator]();!(l=(c=a.next()).done);l=!0){var r=c.value;r._chklst_selected=-1<t.indexOf(""+r.value)}}catch(e){i=!0,n=e}finally{try{!l&&a.return&&a.return()}finally{if(i)throw n}}d.items=e;var o=k.Handlebars.compile(f.template)(d),u=h(o);s.after(u),(d.$ele=u).on("change","[ckl-item] input",function(){var e=_.getValue.apply(s);e?(Array.isArray(e)||(e=[e]),s.html(h.map(e,function(e){return'<option value="'+e+'" selected></>'}).join(""))):s.html(""),s.trigger("change")}),u.find("[ckl-select-all]").click(function(){u.find("input:radio,input:checkbox").prop("checked",!0)}),u.find("[ckl-deselect-all]").click(function(){u.find("input:radio,input:checkbox").prop("checked",!1)})})}))}},x=function(e){var t=_.getValue.call(h(e));return h(e).prop("multiple")||(t=null==t?[]:[t]),t}});
